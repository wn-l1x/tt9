DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS ATTEMPTS CASCADE;
DROP TABLE IF EXISTS QUIZZES CASCADE;
DROP TABLE IF EXISTS QUESTIONS CASCADE;
DROP TABLE IF EXISTS ATTEMPT_DETAIL CASCADE;

CREATE TABLE USERS(
    ID SERIAL PRIMARY KEY,
    USERNAME TEXT NOT NULL,
    PW TEXT NOT NULL,
    EMAIL TEXT NOT NULL
);

CREATE TABLE QUIZZES(
    ID SERIAL PRIMARY KEY,
    TITLE TEXT NOT NULL,
    CREATOR_ID INT,
    FOREIGN KEY (CREATOR_ID) REFERENCES USERS(ID)
);

CREATE TABLE ATTEMPTS(
    ID SERIAL PRIMARY KEY,
    ATTEMPT_TIME TIME NOT NULL,
    USER_ID INT NOT NULL,
    QUIZ_ID INT NOT NULL,
    SCORE INT,
    FOREIGN KEY (USER_ID) REFERENCES USERS(ID),
    FOREIGN KEY (QUIZ_ID) REFERENCES QUIZZES(ID)
);

CREATE TABLE QUESTIONS(
    ID SERIAL PRIMARY KEY,
    QUIZ_ID INT,
    QUESTION TEXT,
    OPTION_A TEXT,
    OPTION_B TEXT,
    OPTION_C TEXT,
    OPTION_D TEXT,
    ANSWER TEXT CHECK (ANSWER IN ('A', 'B', 'C', 'D')),
    FOREIGN KEY (QUIZ_ID) REFERENCES QUIZZES(ID)
);

CREATE TABLE ATTEMPT_DETAIL(
    ID SERIAL PRIMARY KEY,
    ATTEMPT_ID INT,
    QUESTION_ID INT,
    ANSWER TEXT CHECK (ANSWER IN ('A', 'B', 'C', 'D')),
    FOREIGN KEY (QUESTION_ID) REFERENCES QUESTIONS(ID)
);